<template>
  <div>
    <p v-if="code">카드 등록 완료! 코드: {{ code }}</p>
    <p v-if="error">에러 발생: {{ error }}</p>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import axios from 'axios';

const code = ref(null);
const error = ref(null);

onMounted(() => {
  const urlParams = new URLSearchParams(window.location.search);
  code.value = urlParams.get('code');
  error.value = urlParams.get('error');

  if (code.value) {
    getAccessToken(code.value);
  }
});

async function getAccessToken(authCode) {
  try {
    const headers = {
      "Authorization": "Basic dGVzdF9za196WExrS0V5cE5BcldtbzUwblgzbG1lYXhZRzVSOg==",
      "Content-Type": "application/json"
    };

    const data = {
      grantType: "AuthorizationCode",
      customerKey: "L3suza3pZXq8sx7QZod00",
      code: authCode
    };

    const response = await axios.post(
      "https://api.tosspayments.com/v1/brandpay/authorizations/access-token",
      data,
      { headers }
    );
    console.log(response.data);
  } catch (err) {
    console.error(err);
  }
}
</script>
